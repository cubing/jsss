import{m as e,B as t,h as i,T as s,o as r,F as n,l as o,S as a,E as h,f as u,q as c}from"./index-03ee41f0.js";import{PerspectiveCamera as l,Vector3 as m,WebGLRenderer as d,Scene as p,Euler as w,MeshBasicMaterial as v,Matrix4 as f,Quaternion as g,Group as D,BoxGeometry as C,Mesh as b,PlaneGeometry as k,DoubleSide as x,BackSide as S,FaceColors as T,Color as y,Geometry as F,Face3 as E}from"three";import{P as A,K as z,s as M,a as B,C as P,I as R,b as O,S as L}from"./index-bceade28.js";function G(e){return e*e*e*(10-e*(15-6*e))}const I=2*Math.PI,U="undefined"!=typeof window&&"ResizeObserver"in window;class Vantage{constructor(e,t,i={}){if(this.element=e,this.scene=t,this.rafID=null,this.stats=null,this.shift=0,this.camera=new l(20,e.offsetWidth/e.offsetHeight,.1,1e3),this.camera.position.copy(i.position?i.position:V),this.camera.lookAt(new m(0,0,0)),this.renderer=new d({antialias:!0,alpha:!0}),this.shift=i.shift?i.shift:0,this.resize(),this.render(),U){new window.ResizeObserver(this.resize.bind(this)).observe(this.element)}e.appendChild(this.renderer.domElement)}resize(){null===this.rafID&&(this.rafID=requestAnimationFrame(this.scheduledResize.bind(this)))}render(){this.stats&&this.stats.begin(),this.renderer.render(this.scene,this.camera),this.stats&&this.stats.end()}scheduledResize(){const e=this.element.offsetWidth,t=this.element.offsetHeight;let i=0;this.shift>0?i=Math.max(0,Math.floor(.5*(e-t))):this.shift<0&&(i=-Math.max(0,Math.floor(.5*(e-t))));let s=0,r=0;t>e&&(r=t-e,s=-Math.floor(.5*r)),this.camera.aspect=e/t,this.camera.setViewOffset(e,t-r,i,s,e,t),this.camera.updateProjectionMatrix(),this.renderer.setPixelRatio(devicePixelRatio||1),this.renderer.setSize(e,t,!1),this.render(),this.rafID=null}}const V=new m(2,4,4);class Twisty3D{constructor(){this.vantages=[],this.scene=new p}newVantage(e,t){const i=new Vantage(e,this.scene,t);return this.vantages.push(i),i}draw(e){this.updateScene(e);for(const e of this.vantages)e.render()}experimentalGetScene(){return this.scene}experimentalGetVantages(){return this.vantages}}class AxisInfo{constructor(e,t,i){this.vector=e,this.fromZ=t,this.color=i,this.stickerMaterial=new v({color:i,side:x}),this.hintStickerMaterial=new v({color:i,side:S})}}const q=[new AxisInfo(new m(0,1,0),new w(-I/4,0,0),16777215),new AxisInfo(new m(-1,0,0),new w(0,-I/4,0),16746496),new AxisInfo(new m(0,0,1),new w(0,0,0),65280),new AxisInfo(new m(1,0,0),new w(0,I/4,0),16711680),new AxisInfo(new m(0,0,-1),new w(0,I/2,0),255),new AxisInfo(new m(0,-1,0),new w(I/4,0,0),16776960)],N={U:0,L:1,F:2,R:3,B:4,D:5},W={U:N.U,u:N.U,y:N.U,L:N.L,l:N.L,M:N.L,F:N.F,f:N.F,S:N.F,z:N.F,R:N.R,r:N.R,x:N.R,B:N.B,b:N.B,D:N.D,d:N.D,E:N.D},j=.85,H=.501,J=1,K=1.45,$={showMainStickers:!0,showHintStickers:!0,showFoundation:!0},_=new v({color:0,opacity:.3,transparent:!0});class CubieDef{constructor(e,t,i){this.orbit=e;const s="string"==typeof t?t.split(""):t;this.stickerFaces=s.map(e=>N[e]),this.matrix=new f,this.matrix.setPosition(X[e]),this.matrix.premultiply((new f).makeRotationFromQuaternion(i))}}function Z(e,t){return(new g).setFromAxisAngle(e,I*t/4)}const Q={O:new m(0,0,0),U:new m(0,-1,0),L:new m(1,0,0),F:new m(0,0,-1),R:new m(-1,0,0),B:new m(0,0,1),D:new m(0,1,0)},X={EDGE:new m(0,1,1),CORNER:new m(1,1,1),CENTER:new m(0,1,0)},Y={EDGE:[0,1].map(e=>(new f).makeRotationAxis(X.EDGE.clone().normalize(),-e*I/2)),CORNER:[0,1,2].map(e=>(new f).makeRotationAxis(X.CORNER.clone().normalize(),-e*I/3)),CENTER:[0,1,2,3].map(e=>(new f).makeRotationAxis(X.CENTER.clone().normalize(),-e*I/4))},ee=[N.U,N.F,N.R],te={EDGE:[new CubieDef("EDGE","UF",Z(Q.O,0)),new CubieDef("EDGE","UR",Z(Q.U,3)),new CubieDef("EDGE","UB",Z(Q.U,2)),new CubieDef("EDGE","UL",Z(Q.U,1)),new CubieDef("EDGE","DF",Z(Q.F,2)),new CubieDef("EDGE","DR",Z(Q.F,2).premultiply(Z(Q.D,1))),new CubieDef("EDGE","DB",Z(Q.F,2).premultiply(Z(Q.D,2))),new CubieDef("EDGE","DL",Z(Q.F,2).premultiply(Z(Q.D,3))),new CubieDef("EDGE","FR",Z(Q.U,3).premultiply(Z(Q.R,3))),new CubieDef("EDGE","FL",Z(Q.U,1).premultiply(Z(Q.R,3))),new CubieDef("EDGE","BR",Z(Q.U,3).premultiply(Z(Q.R,1))),new CubieDef("EDGE","BL",Z(Q.U,1).premultiply(Z(Q.R,1)))],CORNER:[new CubieDef("CORNER","UFR",Z(Q.O,0)),new CubieDef("CORNER","URB",Z(Q.U,3)),new CubieDef("CORNER","UBL",Z(Q.U,2)),new CubieDef("CORNER","ULF",Z(Q.U,1)),new CubieDef("CORNER","DRF",Z(Q.F,2).premultiply(Z(Q.D,1))),new CubieDef("CORNER","DFL",Z(Q.F,2).premultiply(Z(Q.D,0))),new CubieDef("CORNER","DLB",Z(Q.F,2).premultiply(Z(Q.D,3))),new CubieDef("CORNER","DBR",Z(Q.F,2).premultiply(Z(Q.D,2)))],CENTER:[new CubieDef("CENTER","U",Z(Q.O,0)),new CubieDef("CENTER","L",Z(Q.R,3).premultiply(Z(Q.U,1))),new CubieDef("CENTER","F",Z(Q.R,3)),new CubieDef("CENTER","R",Z(Q.R,3).premultiply(Z(Q.D,1))),new CubieDef("CENTER","B",Z(Q.R,3).premultiply(Z(Q.D,2))),new CubieDef("CENTER","D",Z(Q.R,2))]};class Cube3D extends Twisty3D{constructor(e,t={}){super(),this.cube=new D,this.pieces={},this.experimentalHintStickerMeshes=[],this.experimentalFoundationMeshes=[],this.options={};for(const e in $)this.options[e]=e in t?t[e]:$[e];if("3x3x3"!==e.name)throw new Error("Invalid puzzle for this Cube3D implementation.");for(const e in te)this.pieces[e]=te[e].map(this.createCubie.bind(this));this.cube.scale.set(1/3,1/3,1/3),this.scene.add(this.cube)}experimentalGetCube(){return this.cube}experimentalUpdateOptions(e){if("showMainStickers"in e)throw new Error("Unimplemented");const t=e.showFoundation;if(void 0!==t&&this.options.showFoundation!==t){this.options.showFoundation=t;for(const e of this.experimentalFoundationMeshes)e.visible=t}const i=e.showHintStickers;if(void 0!==i&&this.options.showHintStickers!==i){this.options.showHintStickers=i;for(const e of this.experimentalHintStickerMeshes)e.visible=i}}updateScene(e){const t=e.state;for(const i in te){const s=te[i];for(let e=0;e<s.length;e++){const s=t[i].permutation[e];this.pieces[i][s].matrix.copy(te[i][e].matrix),this.pieces[i][s].matrix.multiply(Y[i][t[i].orientation[e]])}for(const r of e.moves){const e=r.move,n=q[W[e.family]].vector,o=(new f).makeRotationAxis(n,-this.ease(r.fraction)*r.direction*e.amount*I/4);for(let r=0;r<s.length;r++){if(r!==A["3x3x3"].moves[e.family][i].permutation[r]||0!==A["3x3x3"].moves[e.family][i].orientation[r]){const e=t[i].permutation[r];this.pieces[i][e].matrix.premultiply(o)}}}}}createCubie(e){const t=new D;if(this.options.showFoundation){const e=this.createCubieFoundation();t.add(e),this.experimentalFoundationMeshes.push(e)}for(let i=0;i<e.stickerFaces.length;i++)if(t.add(this.createSticker(q[ee[i]],q[e.stickerFaces[i]],!1)),this.options.showHintStickers){const s=this.createSticker(q[ee[i]],q[e.stickerFaces[i]],!0);t.add(s),this.experimentalHintStickerMeshes.push(s)}return t.matrix.copy(e.matrix),t.matrixAutoUpdate=!1,this.cube.add(t),t}createCubieFoundation(){const e=new C(J,J,J);return new b(e,_)}createSticker(e,t,i){const s=new k(j,j),r=new b(s,i?t.hintStickerMaterial:t.stickerMaterial);return r.setRotationFromEuler(e.fromZ),r.position.copy(e.vector),r.position.multiplyScalar(i?K:H),r}ease(e){return G(e)}}const ie=new v({side:x,color:0,transparent:!0,opacity:.75}),se=new v({vertexColors:T}),re=new v({transparent:!0,opacity:0,color:0});class StickerDef{constructor(e,t){this.origColor=new y(e.color),this.faceColor=new y(e.color),this.cubie=new D,this.geo=new F;const i=e.coords,s=[];for(const e of i){const t=new m(e[0],e[1],e[2]);s.push(this.geo.vertices.length),this.geo.vertices.push(t)}for(let e=1;e+1<s.length;e++){const t=new E(s[0],s[e],s[e+1]);t.color=this.faceColor,this.geo.faces.push(t)}this.geo.computeFaceNormals();const r=new b(this.geo,se);if(this.cubie.add(r),t){const e=new b(this.geo,ie);e.scale.setScalar(.99),this.cubie.add(e)}}setColor(e){this.geo.colorsNeedUpdate=!0,this.faceColor.copy(e)}}class HitPlaneDef{constructor(e){this.cubie=new D,this.geo=new F;const t=e.coords,i=[];for(const e of t){const t=new m(e[0],e[1],e[2]);i.push(this.geo.vertices.length),this.geo.vertices.push(t)}for(let e=1;e+1<i.length;e++){const t=new E(i[0],i[e],i[e+1]);this.geo.faces.push(t)}this.geo.computeFaceNormals();const s=new b(this.geo,re);s.userData.name=e.name,this.cubie.scale.setScalar(.99),this.cubie.add(s)}}class AxisInfo$1{constructor(e){const t=e[0];this.axis=new m(t[0],t[1],t[2]),this.order=e[2]}}class PG3D extends Twisty3D{constructor(e,t,i=!1){super(),this.definition=e,this.group=new D,this.stickerTargets=[],this.controlTargets=[],this.axesInfo={};const s=t.axis;for(const e of s)this.axesInfo[e[1]]=new AxisInfo$1(e);const r=t.stickers;this.stickers={};for(const e of r){const t=e.orbit,s=e.ord,r=e.ori;this.stickers[t]||(this.stickers[t]=[]),this.stickers[t][r]||(this.stickers[t][r]=[]);const n=new StickerDef(e,i);n.cubie.scale.set(.5,.5,.5),this.stickers[t][r][s]=n,this.group.add(n.cubie),this.stickerTargets.push(n.cubie.children[0])}const n=t.faces;for(const e of n){const t=new HitPlaneDef(e);t.cubie.scale.set(.5,.5,.5),this.group.add(t.cubie),this.controlTargets.push(t.cubie.children[0])}this.scene.add(this.group)}experimentalGetStickerTargets(){return this.stickerTargets}experimentalGetControlTargets(){return this.controlTargets}experimentalGetGroup(){return this.group}updateScene(t){const i=t.state,s=new w;for(const e in this.stickers){const t=this.stickers[e],r=i[e],n=t.length;for(let e=0;e<n;e++){const i=t[e];for(let o=0;o<i.length;o++){i[o].cubie.rotation.copy(s);const a=(e+n-r.orientation[o])%n,h=r.permutation[o];i[o].setColor(t[a][h].origColor)}}}const r=new z(this.definition);for(const i of t.moves){const t=i.move,s=e(t,{amount:1}),n=r.unswizzle(t.family),o=M(this.definition,s),a=this.axesInfo[n],h=a.axis,u=-this.ease(i.fraction)*i.direction*t.amount*I/a.order;for(const e in this.stickers){const t=this.stickers[e],i=t.length,s=o[e];for(let e=0;e<i;e++){const i=t[e];for(let e=0;e<i.length;e++){s.permutation[e]===e&&0===s.orientation[e]||i[e].cubie.rotateOnAxis(h,u)}}}}}ease(e){return G(e)}}class AlgPartDecoration{constructor(e,t,i,s,r,n=[]){this.moveCount=t,this.duration=i,this.forward=s,this.backward=r,this.children=n}}class DecoratorConstructor extends i{constructor(e){super(),this.puz=e,this.durationFn=new Cursor.AlgDuration(Cursor.DefaultDurationForAmount),this.identity=e.identity(),this.dummyLeaf=new AlgPartDecoration(e,0,0,this.identity,this.identity,[])}traverseSequence(e){let t=0,i=0,s=this.identity;const r=[];for(const n of e.nestedUnits){const e=this.traverse(n);t+=e.moveCount,i+=e.duration,s=this.puz.combine(s,e.forward),r.push(e)}return new AlgPartDecoration(this.puz,t,i,s,this.puz.invert(s),r)}traverseGroup(e){const t=this.traverseSequence(e.nestedSequence);return this.mult(t,e.amount,[t])}traverseBlockMove(e){return new AlgPartDecoration(this.puz,1,this.durationFn.traverse(e),this.puz.stateFromMove(e),this.puz.stateFromMove(ne(e)))}traverseCommutator(e){const t=this.traverseSequence(e.A),i=this.traverseSequence(e.B),s=this.puz.combine(t.forward,i.forward),r=this.puz.combine(t.backward,i.backward),n=this.puz.combine(s,r),o=new AlgPartDecoration(this.puz,2*(t.moveCount+i.moveCount),2*(t.duration+i.duration),n,this.puz.invert(n),[t,i]);return this.mult(o,e.amount,[o,t,i])}traverseConjugate(e){const t=this.traverseSequence(e.A),i=this.traverseSequence(e.B),s=this.puz.combine(t.forward,i.forward),r=this.puz.combine(s,t.backward),n=new AlgPartDecoration(this.puz,2*t.moveCount+i.moveCount,2*t.duration+i.duration,r,this.puz.invert(r),[t,i]);return this.mult(n,e.amount,[n,t,i])}traversePause(e){return new AlgPartDecoration(this.puz,1,this.durationFn.traverse(e),this.identity,this.identity)}traverseNewLine(e){return this.dummyLeaf}traverseComment(e){return this.dummyLeaf}mult(e,t,i){const s=Math.abs(t),r=this.puz.multiply(e.forward,t);return new AlgPartDecoration(this.puz,e.moveCount*s,e.duration*s,r,this.puz.invert(r),i)}}class WalkerDown{constructor(e,t){this.apd=e,this.back=t}}class AlgWalker extends s{constructor(e,t,i){super(),this.puz=e,this.alg=t,this.apd=i,this.i=-1,this.dur=-1,this.goali=-1,this.goaldur=-1,this.mv=void 0,this.back=!1,this.moveDur=0,this.st=this.puz.identity(),this.root=new WalkerDown(this.apd,!1)}moveByIndex(e){return this.i>=0&&this.i===e?void 0!==this.mv:this.dosearch(e,1/0)}moveByDuration(e){return this.dur>=0&&this.dur<e&&this.dur+this.moveDur>=e?void 0!==this.mv:this.dosearch(1/0,e)}dosearch(e,t){return this.goali=e,this.goaldur=t,this.i=0,this.dur=0,this.mv=void 0,this.moveDur=0,this.back=!1,this.st=this.puz.identity(),this.traverse(this.alg,this.root)}traverseSequence(e,t){if(!this.firstcheck(t))return!1;if(t.back)for(let i=e.nestedUnits.length-1;i>=0;i--){const s=e.nestedUnits[i];if(this.traverse(s,new WalkerDown(t.apd.children[i],t.back)))return!0}else for(let i=0;i<e.nestedUnits.length;i++){const s=e.nestedUnits[i];if(this.traverse(s,new WalkerDown(t.apd.children[i],t.back)))return!0}return!1}traverseGroup(e,t){if(!this.firstcheck(t))return!1;const i=this.domult(t,e.amount);return this.traverse(e.nestedSequence,new WalkerDown(t.apd.children[0],i))}traverseBlockMove(e,t){return!!this.firstcheck(t)&&(this.mv=e,this.moveDur=t.apd.duration,this.back=t.back,!0)}traverseCommutator(e,t){if(!this.firstcheck(t))return!1;const i=this.domult(t,e.amount);return i?this.traverse(e.B,new WalkerDown(t.apd.children[2],!i))||this.traverse(e.A,new WalkerDown(t.apd.children[1],!i))||this.traverse(e.B,new WalkerDown(t.apd.children[2],i))||this.traverse(e.A,new WalkerDown(t.apd.children[1],i)):this.traverse(e.A,new WalkerDown(t.apd.children[1],i))||this.traverse(e.B,new WalkerDown(t.apd.children[2],i))||this.traverse(e.A,new WalkerDown(t.apd.children[1],!i))||this.traverse(e.B,new WalkerDown(t.apd.children[2],!i))}traverseConjugate(e,t){if(!this.firstcheck(t))return!1;const i=this.domult(t,e.amount);return i?this.traverse(e.A,new WalkerDown(t.apd.children[1],!i))||this.traverse(e.B,new WalkerDown(t.apd.children[2],i))||this.traverse(e.A,new WalkerDown(t.apd.children[1],i)):this.traverse(e.A,new WalkerDown(t.apd.children[1],i))||this.traverse(e.B,new WalkerDown(t.apd.children[2],i))||this.traverse(e.A,new WalkerDown(t.apd.children[1],!i))}traversePause(e,t){return!!this.firstcheck(t)&&(this.mv=e,this.moveDur=t.apd.duration,this.back=t.back,!0)}traverseNewLine(e,t){return!1}traverseComment(e,t){return!1}firstcheck(e){return!(e.apd.moveCount+this.i<=this.goali&&e.apd.duration+this.dur<this.goaldur)||this.keepgoing(e)}domult(e,t){let i=e.back;if(0===t)return i;t<0&&(i=!i,t=-t);const s=e.apd.children[0],r=Math.min(Math.floor((this.goali-this.i)/s.moveCount),Math.ceil((this.goaldur-this.dur)/s.duration-1));return r>0&&this.keepgoing(new WalkerDown(s,i),r),i}keepgoing(e,t=1){return this.i+=t*e.apd.moveCount,this.dur+=t*e.apd.duration,1!==t?e.back?this.st=this.puz.combine(this.st,this.puz.multiply(e.apd.backward,t)):this.st=this.puz.combine(this.st,this.puz.multiply(e.apd.forward,t)):e.back?this.st=this.puz.combine(this.st,e.apd.backward):this.st=this.puz.combine(this.st,e.apd.forward),!1}}function ne(e){return new t(e.outerLayer,e.innerLayer,e.family,-e.amount)}class TreeAlgorithmIndexer{constructor(e,t){this.puzzle=e;const i=new DecoratorConstructor(this.puzzle);this.decoration=i.traverse(t),this.walker=new AlgWalker(this.puzzle,t,this.decoration)}getMove(e){if(this.walker.moveByIndex(e)){const e=this.walker.mv;return this.walker.back?ne(e):e}throw new Error("Out of algorithm: index "+e)}indexToMoveStartTimestamp(e){if(this.walker.moveByIndex(e)||this.walker.i===e)return this.walker.dur;throw new Error("Out of algorithm: index "+e)}stateAtIndex(e){return this.walker.moveByIndex(e),this.puzzle.combine(this.puzzle.startState(),this.walker.st)}transformAtIndex(e){return this.walker.moveByIndex(e),this.walker.st}numMoves(){return this.decoration.moveCount}timestampToIndex(e){return this.walker.moveByDuration(e),this.walker.i}algDuration(){return this.decoration.duration}moveDuration(e){return this.walker.moveByIndex(e),this.walker.moveDur}}const oe=new class CountAnimatedMoves extends i{traverseSequence(e){let t=0;for(const i of e.nestedUnits)t+=this.traverse(i);return t}traverseGroup(e){return this.traverseSequence(e.nestedSequence)}traverseBlockMove(e){return 1}traverseCommutator(e){return 2*(this.traverseSequence(e.A)+this.traverseSequence(e.B))}traverseConjugate(e){return 2*this.traverseSequence(e.A)+this.traverseSequence(e.B)}traversePause(e){return 0}traverseNewLine(e){return 0}traverseComment(e){return 0}};oe.traverse.bind(oe);class SingleAnimatedMove{constructor(e,t){this.priorState=e,this.move=t,this.moveDuration=Cursor.DefaultDurationForAmount(this.move.amount),this.algTimestamp=0}doLastMoveDelta(e){return this.algTimestamp+=e,this.algTimestamp<0||this.algTimestamp>=this.moveDuration}}class Cursor{constructor(e,t){this.alg=e,this.puzzle=t,this.setMoves(e),this.setPositionToStart()}experimentalSetMoves(e){return this.setMoves(e)}experimentalUpdateAlgAnimate(e,t){const i=this.indexer.stateAtIndex(this.indexer.numMoves());this.setMoves(e),this.lastMoveData=new SingleAnimatedMove(i,t)}setPositionToStart(){this.lastMoveData=void 0,this.algTimestamp=0}setPositionToEnd(){this.lastMoveData=void 0,this.setPositionToStart(),this.forward(this.endOfAlg(),!1)}startOfAlg(){return 0}endOfAlg(){return this.indexer.algDuration()}currentPosition(){if(this.lastMoveData){const e={state:this.lastMoveData.priorState,moves:[]},t=this.lastMoveData.move,i=this.lastMoveData.algTimestamp;return 0!==i&&e.moves.push({move:t,direction:Cursor.Direction.Forwards,fraction:i/this.lastMoveData.moveDuration}),e}const e=this.indexer.timestampToIndex(this.algTimestamp),t={state:this.indexer.stateAtIndex(e),moves:[]};if(0===this.indexer.numMoves())return t;const i=this.indexer.getMove(e),s=this.algTimestamp-this.indexer.indexToMoveStartTimestamp(e),r=this.indexer.indexToMoveStartTimestamp(e+1)-this.indexer.indexToMoveStartTimestamp(e);return 0!==s&&t.moves.push({move:i,direction:Cursor.Direction.Forwards,fraction:s/r}),t}currentTimestamp(){return this.algTimestamp}delta(e,t){if(this.lastMoveData){if(!this.lastMoveData.doLastMoveDelta(e))return!1;this.lastMoveData=void 0,e=1e30,this.algTimestamp=this.indexer.algDuration()}const i=this.indexer.timestampToIndex(this.algTimestamp),s=this.algTimestamp+e,r=this.indexer.indexToMoveStartTimestamp(i);if(t){if(s<r)return this.algTimestamp=r,!0;const e=r+this.indexer.moveDuration(i);if(s>e)return this.algTimestamp=e,!0}return this.algTimestamp=Math.max(0,Math.min(this.indexer.algDuration(),s)),this.algTimestamp===this.indexer.algDuration()}experimentalSetDurationScale(e){}forward(e,t){return this.delta(e,t)}backward(e,t){return this.delta(-e,t)}setMoves(e){this.lastMoveData=void 0,this.indexer=new TreeAlgorithmIndexer(this.puzzle,e)}}!function(e){let t,s;function r(e){switch(Math.abs(e)){case 0:return 0;case 1:return 1e3;case 2:return 1500;default:return 2e3}}!function(e){e[e.Forwards=1]="Forwards",e[e.Paused=0]="Paused",e[e.Backwards=-1]="Backwards"}(t=e.Direction||(e.Direction={})),function(e){e[e.Move=0]="Move",e[e.EntireMoveSequence=1]="EntireMoveSequence"}(s=e.BreakpointType||(e.BreakpointType={})),e.ConstantDurationForAmount=function(e){return 1e3},e.DefaultDurationForAmount=r,e.ExperimentalScaledDefaultDurationForAmount=function(e,t){switch(Math.abs(t)){case 0:return 0;case 1:return 1e3*e;case 2:return 1500*e;default:return 2e3*e}};e.AlgDuration=class AlgDuration extends i{constructor(e=r){super(),this.durationForAmount=e}traverseSequence(e){let t=0;for(const i of e.nestedUnits)t+=this.traverse(i);return t}traverseGroup(e){return e.amount*this.traverse(e.nestedSequence)}traverseBlockMove(e){return this.durationForAmount(e.amount)}traverseCommutator(e){return 2*e.amount*(this.traverse(e.A)+this.traverse(e.B))}traverseConjugate(e){return e.amount*(2*this.traverse(e.A)+this.traverse(e.B))}traversePause(e){return this.durationForAmount(1)}traverseNewLine(e){return this.durationForAmount(1)}traverseComment(e){return this.durationForAmount(0)}}}(Cursor||(Cursor={}));class KSolvePuzzle extends class Puzzle{multiply(e,t){if(t<0)return this.invert(this.multiply(e,-t));let i=this.identity();for(;t>0;)t%2==1&&(i=this.combine(i,e)),t=Math.floor(t/2),e=this.combine(e,e);return i}}{constructor(e){super(),this.definition=e,this.moveStash={}}static fromID(e){return new KSolvePuzzle(A[e])}startState(){return this.definition.startPieces}invert(e){return B(this.definition,e)}combine(e,t){return P(this.definition,e,t)}stateFromMove(e){const t=r(e);return this.moveStash[t]||(this.moveStash[t]=M(this.definition,e)),this.moveStash[t]}identity(){return R(this.definition)}equivalent(e,t){return O(this.definition,e,t)}}function ae(e,t){const i=e.family[0].toLowerCase()+t.family[0].toLowerCase();return-1!==["uu","ud","du","dd","ll","lr","rl","rr","ff","fb","bf","bb"].indexOf(i)}function he(e,i=200){return function(e,i){const s=[],r=new Map;let o=null;for(const a of e){if(!o){o={event:a,start:a.timeStamp-i/2,end:a.timeStamp+i/2},s.push([o]),r.set(n(o.event.move),o);continue}const e={event:a,start:a.timeStamp-i/2,end:a.timeStamp+i/2};if(ae(o.event.move,a.move)){const i=n(e.event.move),o=r.get(i);o&&o.end>e.start&&Math.sign(o.event.move.amount)===Math.sign(e.event.move.amount)?o.event.move=new t(o.event.move.outerLayer,o.event.move.innerLayer,o.event.move.family,o.event.move.amount+e.event.move.amount):(s[s.length-1].push(e),r.set(i,e))}else if(s.push([e]),r.clear(),r.set(n(e.event.move),e),e.start<o.end){const t=(e.start+o.end)/2;e.start=t,o.end=t}o=e}return s}(e,i).flat()}class Dispatcher{constructor(){this.cursorObservers=new Set,this.directionObservers=new Set,this.jumpObservers=new Set}registerCursorObserver(e){if(this.cursorObservers.has(e))throw new Error("Duplicate cursor observer added.");this.cursorObservers.add(e)}registerDirectionObserver(e){if(this.directionObservers.has(e))throw new Error("Duplicate direction observer added.");this.directionObservers.add(e)}registerJumpObserver(e){if(this.jumpObservers.has(e))throw new Error("Duplicate direction observer added.");this.jumpObservers.add(e)}animCursorChanged(e){for(const t of this.cursorObservers)t.animCursorChanged(e)}animDirectionChanged(e){for(const t of this.directionObservers)t.animDirectionChanged(e)}animCursorJumped(){for(const e of this.jumpObservers)e.animCursorJumped()}}class AnimModel{constructor(e){this.cursor=e,this.dispatcher=new Dispatcher,this.lastCursorTime=0,this.direction=Cursor.Direction.Paused,this.breakpointType=Cursor.BreakpointType.EntireMoveSequence,this.tempo=1.5,this.scheduler=new FrameScheduler(this.frame.bind(this))}experimentalGetScheduler(){return this.scheduler}getBounds(){return[this.cursor.startOfAlg(),this.cursor.endOfAlg()]}isPaused(){return this.direction===Cursor.Direction.Paused}skipAndPauseTo(e){this.pause(),this.cursor.setPositionToStart(),this.cursor.forward(e,!1),this.scheduler.singleFrame()}playForward(){this.setBreakpointType(Cursor.BreakpointType.EntireMoveSequence),this.animateDirection(Cursor.Direction.Forwards)}pause(){this.animateDirection(Cursor.Direction.Paused)}playBackward(){this.setBreakpointType(Cursor.BreakpointType.EntireMoveSequence),this.animateDirection(Cursor.Direction.Backwards)}skipToStart(){this.skipAndPauseTo(this.cursor.startOfAlg()),this.dispatcher.animCursorJumped()}skipToEnd(){this.skipAndPauseTo(this.cursor.endOfAlg()),this.dispatcher.animCursorJumped()}isAtEnd(){return this.cursor.currentTimestamp()===this.cursor.endOfAlg()}stepForward(){this.cursor.forward(.1,!1),this.setBreakpointType(Cursor.BreakpointType.Move),this.animateDirection(Cursor.Direction.Forwards)}stepBackward(){this.cursor.backward(.1,!1),this.setBreakpointType(Cursor.BreakpointType.Move),this.animateDirection(Cursor.Direction.Backwards)}togglePausePlayForward(){this.isPaused()?this.playForward():this.pause()}timeScaling(){return this.direction*this.tempo}updateCursor(e){if(this.direction===Cursor.Direction.Paused)return void(this.lastCursorTime=e);let t=e-this.lastCursorTime;this.lastCursorTime=e,t<0&&(t=0),this.cursor.delta(t*this.timeScaling(),this.breakpointType===Cursor.BreakpointType.Move)&&(this.setDirection(Cursor.Direction.Paused),this.scheduler.stop())}setDirection(e){this.direction=e,this.dispatcher.animDirectionChanged(e)}frame(e){this.updateCursor(e),this.dispatcher.animCursorChanged(this.cursor)}setBreakpointType(e){this.breakpointType=e}animateDirection(e){this.direction!==e&&(this.updateCursor(performance.now()),this.setDirection(e),e===Cursor.Direction.Paused?this.scheduler.stop():this.scheduler.start())}}class FrameScheduler{constructor(e){this.callback=e,this.animating=!1,this.lastRenderTimestamp=-1}animFrame(e){e!==this.lastRenderTimestamp&&(this.lastRenderTimestamp=e,this.callback(e)),this.animating&&requestAnimationFrame(this.animFrame.bind(this))}start(){this.animating||(this.animating=!0,requestAnimationFrame(this.animFrame.bind(this)))}stop(){this.animating=!1}singleFrame(){this.start(),this.stop()}}let ue=!0;function ce(e){ue=e}class Button{constructor(e,t){this.element=document.createElement("button"),this.element.title=e,this.element.classList.add(t),this.element.addEventListener("click",this.onpress.bind(this))}}!function(e){e.Fullscreen=class Fullscreen extends e{constructor(e){super("Full Screen","fullscreen"),this.fullscreenElement=e}onpress(){var e;(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement||document.webkitFullscreenElement)===this.fullscreenElement?(document.exitFullscreen||document.mozCancelFullScreen||document.msExitFullscreen||document.webkitExitFullscreen).call(document):((e=this.fullscreenElement).requestFullscreen||e.mozRequestFullScreen||e.msRequestFullscreen||e.webkitRequestFullscreen).call(e)}};e.SkipToStart=class SkipToStart extends e{constructor(e){super("Skip To Start","skip-to-start"),this.anim=e}onpress(){this.anim.skipToStart()}};e.SkipToEnd=class SkipToEnd extends e{constructor(e){super("Skip To End","skip-to-end"),this.anim=e}onpress(){this.anim.skipToEnd()}};e.PlayPause=class PlayPause extends e{constructor(e){super("Play","play"),this.anim=e,this.anim.dispatcher.registerDirectionObserver(this)}onpress(){this.anim.isPaused()&&this.anim.isAtEnd()&&this.anim.skipToStart(),this.anim.togglePausePlayForward()}animDirectionChanged(e){const t=e===Cursor.Direction.Paused?"play":"pause";this.element.classList.remove("play","pause"),this.element.classList.add(t),this.element.title=e===Cursor.Direction.Paused?"Play":"Pause"}};e.StepForward=class StepForward extends e{constructor(e){super("Step forward","step-forward"),this.anim=e}onpress(){this.anim.stepForward()}};e.StepBackward=class StepBackward extends e{constructor(e){super("Step backward","step-backward"),this.anim=e}onpress(){this.anim.stepBackward()}}}(Button||(Button={}));class ControlBar{constructor(e,t){this.element=document.createElement("twisty-control-bar"),this.element.appendChild(new Button.Fullscreen(t).element),this.element.appendChild(new Button.SkipToStart(e).element),this.element.appendChild(new Button.StepBackward(e).element),this.element.appendChild(new Button.PlayPause(e).element),this.element.appendChild(new Button.StepForward(e).element),this.element.appendChild(new Button.SkipToEnd(e).element)}}class Scrubber{constructor(e){this.anim=e,this.element=document.createElement("input"),this.element.classList.add("scrubber"),this.element.type="range",this.element.addEventListener("input",this.oninput.bind(this)),this.updateFromAnim(),this.anim.dispatcher.registerCursorObserver(this)}updateFromAnim(){const e=this.anim.getBounds();this.element.min=String(e[0]),this.element.max=String(e[1]),this.element.value=String(this.anim.cursor.currentTimestamp())}animCursorChanged(e){this.element.value=String(e.currentTimestamp()),this.updateBackground()}animBoundsChanged(){this.updateBackground()}updateBackground(){const e=parseInt(this.element.min,10),t=parseInt(this.element.max,10),i=(parseInt(this.element.value,10)-e)/t*100;this.element.style.background=`linear-gradient(to right,       rgb(0, 63, 255) 0%,       rgb(0, 63, 255) ${i}%,       rgba(0, 0, 0, 0.25) ${i}%,       rgba(0, 0, 0, 0.25) 100%      )`}oninput(){this.anim.skipAndPauseTo(parseInt(this.element.value,10)),this.updateBackground()}}class CursorTextMoveView{constructor(e){this.anim=e,this.element=document.createElement("cursor-text-view"),this.anim.dispatcher.registerCursorObserver(this),this.animCursorChanged(e.cursor)}animCursorChanged(e){const t=e.currentPosition();let i=""+Math.floor(e.currentTimestamp());t.moves.length>0&&(i+=" "+o(new a([t.moves[0].move]))+" "+this.formatFraction(t.moves[0].fraction)),this.element.textContent=i}formatFraction(e){return(String(e)+(Math.floor(e)===e?".":"")+"000000").slice(0,5)}}class KSolveView{constructor(e,t){this.anim=e,this.definition=t,this.element=document.createElement("ksolve-svg-view"),this.anim.dispatcher.registerCursorObserver(this),this.anim.dispatcher.registerJumpObserver(this),this.svg=new L(t),this.element.appendChild(this.svg.element)}animCursorChanged(e){const i=e.currentPosition();if(i.moves.length>0){const e=i.moves[0].move,s=this.definition,r=new t(e.outerLayer,e.innerLayer,e.family,e.amount*i.moves[0].direction),n=P(s,i.state,M(s,r));this.svg.draw(this.definition,i.state,n,i.moves[0].fraction)}else this.svg.draw(this.definition,i.state)}animCursorJumped(){ue&&(this.element.classList.add("flash"),setTimeout(()=>this.element.classList.remove("flash"),0))}}class Cube3DView{constructor(e,t,i={}){var s;this.anim=e,this.config=i,this.element=document.createElement("cube3d-view"),this.element.tabIndex=0,this.anim.dispatcher.registerCursorObserver(this),this.anim.dispatcher.registerJumpObserver(this),this.cube3D=new Cube3D(t);const r=document.createElement("cube3d-wrapper");r.classList.add("front"),this.element.appendChild(r),setTimeout(()=>{this.cube3D.newVantage(r)},0),null!==(s=this.config.experimentalShowBackView)&&void 0!==s&&s&&this.createBackViewForTesting()}createBackViewForTesting(){const e=document.createElement("cube3d-wrapper");e.classList.add("back"),this.element.appendChild(e),setTimeout(()=>{this.cube3D.newVantage(e,{position:new m(-1.25,-2.5,-2.5)})},0)}animCursorChanged(e){this.cube3D.draw(e.currentPosition())}animCursorJumped(){ue&&(this.element.classList.add("flash"),setTimeout(()=>this.element.classList.remove("flash"),0))}experimentalGetCube3D(){return this.cube3D}}class PG3DView{constructor(e,t,i){var s,r;this.anim=e,this.definition=t,this.config=i,this.element=document.createElement("cube3d-view"),null!==(s=this.config.sideBySide)&&void 0!==s&&s&&this.element.classList.add("side-by-side");const n=document.createElement("cube3d-wrapper");n.classList.add("front"),this.element.appendChild(n),this.anim.dispatcher.registerCursorObserver(this),this.anim.dispatcher.registerJumpObserver(this),this.pg3D=new PG3D(this.definition,this.config.stickerDat,null!==(r=this.config.showFoundation)&&void 0!==r&&r),setTimeout(()=>{const e=this.config.experimentalPolarVantages?new m(0,0,-5.5):new m(0,-4.4,-4.4);this.pg3D.newVantage(n,{position:e,shift:this.config.sideBySide?-1:0})},0),this.createBackViewForTesting()}animCursorChanged(e){this.pg3D.draw(e.currentPosition())}animCursorJumped(){ue&&(this.element.classList.add("flash"),setTimeout(()=>this.element.classList.remove("flash"),0))}experimentalGetPG3D(){return this.pg3D}createBackViewForTesting(){const e=document.createElement("cube3d-wrapper");e.classList.add("back"),this.element.appendChild(e),setTimeout(()=>{const t=this.config.experimentalPolarVantages?new m(0,0,5.5):new m(0,4.4,4.4);this.pg3D.newVantage(e,{position:t,shift:this.config.sideBySide?1:0})},0)}}class Player{constructor(e,t,i={}){var s;this.anim=e,this.config=i,this.element=document.createElement("player"),"PG3D"===this.config.visualizationFormat?this.element.appendChild((this.pg3DView=new PG3DView(this.anim,t,i.experimentalPG3DViewConfig)).element):"3D"===this.config.visualizationFormat?"3x3x3"===t.name?this.element.appendChild((this.cube3DView=new Cube3DView(this.anim,t,this.config.experimentalCube3DViewConfig)).element):(console.warn(`3D visualization specified for unsupported puzzle: ${t.name}. Falling back to 2D.`),this.element.appendChild(new KSolveView(this.anim,t).element)):this.config.visualizationFormat||"3x3x3"!==t.name?this.element.appendChild(new KSolveView(this.anim,t).element):this.element.appendChild((this.cube3DView=new Cube3DView(this.anim,t,this.config.experimentalCube3DViewConfig)).element),this.scrubber=new Scrubber(this.anim),(null===(s=this.config.experimentalShowControls)||void 0===s||s)&&(this.element.appendChild(this.scrubber.element),this.element.appendChild(new ControlBar(this.anim,this.element).element),this.element.appendChild(new CursorTextMoveView(this.anim).element))}updateFromAnim(){this.scrubber.updateFromAnim()}}var le,me,de,pe=function(e,t,i){if(!t.has(e))throw new TypeError("attempted to set private field on non-instance");return t.set(e,i),i},we=function(e,t){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return t.get(e)};class TwistyParams{}class Twisty{constructor(e,t={}){this.element=e,le.set(this,void 0),me.set(this,void 0),de.set(this,void 0),this.alg=t.alg||h.Niklas,this.puzzleDef=t.puzzle||A["3x3x3"],pe(this,me,new Cursor(this.alg,new KSolvePuzzle(this.puzzleDef))),pe(this,le,new AnimModel(we(this,me))),pe(this,de,new Player(we(this,le),this.puzzleDef,t.playerConfig)),this.element.appendChild(we(this,de).element),this.coalesceModFunc=e=>0}setCoalesceModFunc(e){this.coalesceModFunc=e}experimentalSetAlg(e,t=!1){we(this,me).experimentalSetMoves(e),we(this,le).skipToStart(),this.alg=e,we(this,le).skipToEnd(),we(this,de).updateFromAnim(),t&&we(this,le).cursor.currentTimestamp()>0&&(we(this,me).backward(.01,!1),we(this,me).backward(1e5,!0),we(this,le).stepForward())}experimentalSetAlgAnimateBlockMove(e,t){we(this,le).skipToStart(),this.alg=e,we(this,le).skipToEnd(),we(this,me).experimentalUpdateAlgAnimate(e,t),we(this,de).updateFromAnim(),we(this,le).stepForward()}experimentalAddMove(e){const t=this.coalesceModFunc(e),i=u(this.alg,e,!0,t);this.experimentalSetAlgAnimateBlockMove(i,e)}experimentalGetAnim(){return we(this,le)}experimentalGetPlayer(){return we(this,de)}experimentalGetCursor(){return we(this,me)}}function ve(e){const t=e.getAttribute("initialization"),i=function(e){const t=new TwistyParams,i=e.getAttribute("puzzle");i&&(t.puzzle=A[i]);const s=e.getAttribute("alg");s&&(t.alg=c(s));const r=e.getAttribute("visualization");return r&&("2D"===r||"3D"===r||"PG3D"===r?t.playerConfig={visualizationFormat:r}:console.warn(`Invalid visualization: ${r}`)),t}(e);return"custom"!==t?new Twisty(e,i):null}le=new WeakMap,me=new WeakMap,de=new WeakMap,"undefined"!=typeof window&&window.addEventListener("load",(function(){const e=document.querySelectorAll("twisty");e.length>0&&console.log(`Found ${e.length} twisty elem${1===e.length?"":"s"} on page.`),e.forEach(ve)}));var fe=Object.freeze({__proto__:null,Cube3D:Cube3D,PG3D:PG3D,TAU:I,Vantage:Vantage,TreeAlgorithmIndexer:TreeAlgorithmIndexer,KSolvePuzzle:KSolvePuzzle,toTimeline:he,Twisty:Twisty,TwistyParams:TwistyParams,experimentalShowJumpingFlash:ce});export{Cube3D as C,KSolvePuzzle as K,PG3D as P,I as T,Vantage as V,TreeAlgorithmIndexer as a,Twisty as b,TwistyParams as c,ce as e,fe as i,he as t};
//# sourceMappingURL=index-8b479c30.js.map
